<!-- Lives at https://betacdn.razorpay.com/qa/index.html -->
<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
  </head>

  <body>
    <script>
      var defaultParams = {
        env: 'prod',
        key: 'rzp_test_1DP5mmOlF5G5ag',
        amount: 105,
      };

      // Keys from config that do not need to be passed to Checkout
      var deleteFromConfig = ['env'];

      // Env <-> Config map
      var configMap = {
        dark: {
          domain: 'checkout-dark.razorpay.com',
          Razorpay: {
            config: {
              frame: 'https://api-dark.razorpay.com/v1/checkout/public',
            },
          },
        },

        prod: {
          domain: 'checkout.razorpay.com',
        },

        canary: {
          domain: 'prod-checkout-canary.razorpay.com',
          Razorpay: {
            config: {
              frame:
                'https://api.razorpay.com/v1/checkout/public/canary?canary=1',
            },
          },
        },
      };

      var queryParams = location.search
        .slice(1)
        .split(/=|&/)
        .reduce(function(map, param, index, array) {
          if (index % 2) {
            map[array[index - 1]] = param;
          }
          return map;
        }, {});

      if (queryParams.api) {
        var Razorpay = {
          config: {
            api: queryParams.api,
          },
        };
      }
    </script>

    <div></div>

    <script>
      // Load Checkout from the given domain
      function loadCheckout(domain, callback) {
        var script = document.createElement('script');
        script.onload = callback;
        script.src = 'https://' + domain + '/v1/checkout.js';
        document.body.appendChild(script);
      }

      // Augment defaultParams with queryParams
      var params = Object.assign({}, defaultParams, queryParams);

      // If env does not have a config, default to prod
      if (!configMap[params.env]) {
        params.env = 'prod';
      }

      // Get the config for this env
      var config = configMap[params.env];

      // Get the Checkout domain
      var domain = config.domain;

      // Get the Razorpay config
      if (config.Razorpay) {
        window.Razorpay = config.Razorpay;
      }

      var div = document.querySelector('div');

      params.handler = function(resp) {
        document.querySelector('div').innerHTML = resp.razorpay_payment_id;
      };

      loadCheckout(domain, function() {
        // Delete extra keys that do not need to be passed to Checkout
        for (var i = 0; i < deleteFromConfig.length; i++) {
          delete params[deleteFromConfig[i]];
        }

        Razorpay(params).open();
      });
    </script>
  </body>
</html>
