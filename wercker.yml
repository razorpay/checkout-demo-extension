box: wercker/nodejs
build:
    steps:
        - npm-install
        - script:
            name: Install harp globally
            code: sudo npm install -g harp
        - grunt:
            tasks: test
        # - script:
        #     name: Run unit tests
        #     code: ./node_modules/karma/bin/karma start --single-run --browsers PhantomJS
    after-steps:
        - williamli/slack-notify-no-owner-info:
            subdomain: razorpay
            token: $SLACK_TOKEN
            channel: tech
deploy:
    steps:
        - npm-install
        - script:
            name: Install harp globally
            code: sudo npm install -g harp
        - grunt:
            tasks: build
        - nhuray/aws-code-deploy:
            key: $AWS_KEY
            secret: $AWS_SECRET
            region: $AWS_REGION
            application-name: Checkout
            deployment-group-name: $WERCKER_DEPLOYTARGET_NAME
            s3-bucket: rzp-codedeploy
    after-steps:
        - williamli/slack-notify-no-owner-info:
            subdomain: razorpay
            token: $SLACK_TOKEN
            channel: tech
        - script:
            name: Bozo Regression Analysis
            code: curl "http://rzp.cloudapp.net:8000/screenshot/$BOZO_TOKEN" -d "commit=$WERCKER_GIT_COMMIT&branch=$WERCKER_GIT_BRANCH"
