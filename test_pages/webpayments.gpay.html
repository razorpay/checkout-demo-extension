<html>
  <head>
    <title>Google Pay Payment Request API Test</title>

    <script>
      // Mock PaymentRequest APIs
      // If this is to be used in Checkout, add this script tag to the <head> of app/checkout.html

      class PaymentRequest {
        canMakePayment = () => {
          const available = true;
          return Promise.resolve(available);
        };

        show = () => {
          alert('At this point, your Google Pay app would be invoked');

          const successPayload = {
            requestId: 'd16076cc-db82-4ced-8b88-a0608ea37f51',
            methodName: 'https://tez.google.com/pay',
            details: {
              tezResponse:
                '{"Status":"SUCCESS","amount":"1.00","txnRef":"FJQDoV8cnH20T3","toVpa":"razorpay.pg@hdfcbank","txnId":"ICI100037bf0ff743659c782aeacde83b86","responseCode":"0"}',
              txnId: 'ICI100037bf0ff743659c782aeacde83b86',
              responseCode: '0',
              ApprovalRefNo: '',
              Status: 'SUCCESS',
              txnRef: 'FJQDoV8cnH20T3',
              TrtxnRef: 'FJQDoV8cnH20T3',
              signature:
                '3045022060e893330caf8a0309b87e33dd98c920cd36e08ae9d9329b26175158ffefc06a02210089127a4e46515fde75619489f65f3372c8a2e2631eacf1736f781e3e71dbf81d',
              signatureKeyId: 'PAYMENT_RESPONSE_V1',
            },
            shippingAddress: null,
            shippingOption: null,
            payerName: null,
            payerEmail: null,
            payerPhone: null,
          };

          const failurePayload = {
            requestId: '3092df4c-9f3d-47ef-8e56-318c7513e398',
            methodName: 'https://tez.google.com/pay',
            details: {
              tezResponse:
                '{"txnId":"","responseCode":"ZD","Status":"FAILURE","txnRef":"FJQ1nu2B8JCh8L"}',
              txnId: '',
              responseCode: 'ZD',
              ApprovalRefNo: '',
              Status: 'FAILURE',
              txnRef: 'FJQ1nu2B8JCh8L',
              TrtxnRef: 'FJQ1nu2B8JCh8L',
              signature: '',
              signatureKeyId: '',
            },
            shippingAddress: null,
            shippingOption: null,
            payerName: null,
            payerEmail: null,
            payerPhone: null,
          };

          let payload = failurePayload;
          if (window.confirm('Should payment succeed from Google Pay app?')) {
            payload = successPayload;
          }

          return Promise.resolve({
            ...payload,
            complete: () => {},
          });
        };
      }

      window.PaymentRequest = PaymentRequest;
    </script>

    <script
      type="text/javascript"
      src="http://checkout.razorpay.com/v1/razorpay.js"
    ></script>
  </head>

  <body>
    <button>Pay</button>

    <script>
      const razorpay = new Razorpay({
        // key: 'rzp_live_ILgsfZCZoFIKMb',
        key: 'rzp_test_1DP5mmOlF5G5ag',
        amount: 100,
      });

      const payload = {
        email: 'void@razorpay.com',
        contact: '+918888888888',
        method: 'upi',
      };

      document.querySelector('button').addEventListener('click', event => {
        razorpay.createPayment(payload, {
          gpay: true,
        });
      });

      razorpay
        .checkPaymentAdapter('gpay')
        .then(() => {
          console.log('Google Pay Web Payments API is available');
        })
        .catch(() => {
          console.error('Google Pay Web Payments API is not available');
        });
    </script>
  </body>
</html>
